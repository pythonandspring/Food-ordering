<!DOCTYPE html>
<html>
{% load static %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
        integrity="sha384-4LISF5TTJX/fLmGSxO53rV4miRxdg84mZsxmO8Rx5jGtp/LbrixFETvWa5a6sESd" crossorigin="anonymous">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap"
        rel="stylesheet">
    <title>Document</title>
    <link rel="stylesheet" href={% static 'css/index.css' %}>
    <link rel="stylesheet" href={% static 'css/forms.css' %}>
    <link rel="stylesheet" href={% static 'css/section.css' %}>
    <link rel="stylesheet" href={% static 'css/search.css' %}>
    <link rel="stylesheet" href="{% static 'css/product-card.css' %}">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- Add jQuery -->

</head>

<body style="background: rgb(245, 245, 245);">
        {% include "home/header.html" %}
    


    <div class="search-container">
        <form method="POST" action="" class="search-form" id="combined-search-form">
            {% csrf_token %}
            <div class="combined-search">
                <!-- Left input: Filter by city -->
                <input 
                    type="text" 
                    name="filter" 
                    placeholder="Search by city" 
                    class="search-input" 
                    value="{{ request.POST.filter }}" 
                    id="filter-input"
                >
    
                <!-- Right input: Search for food/restaurants -->
                <input 
                    type="text" 
                    name="search" 
                    placeholder="Search for food or restaurants" 
                    class="search-input" 
                    value="{{ request.POST.search }}" 
                    id="search-input"
                >
            </div>
        </form>
    </div>
    
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("combined-search-form");
            const filterInput = document.getElementById("filter-input");
            const searchInput = document.getElementById("search-input");
    
            form.addEventListener("keydown", (event) => {
                // Submit the form when Enter is pressed
                if (event.key === "Enter") {
                    event.preventDefault(); // Prevent default form submission
    
                    // Determine which input field is active
                    if (document.activeElement === filterInput) {
                        form.action = "{% url 'filter' %}";
                    } else if (document.activeElement === searchInput) {
                        form.action = "{% url 'search' %}";
                    }
    
                    form.submit(); // Submit the form
                }
            });
        });
    </script>
    

<!-- Include jQuery and jQuery UI for autocomplete -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<script>
$(document).ready(function() {
    $("#filter-input").autocomplete({
        source: function(request, response) {
            $.ajax({
                url: "{% url 'city_autocomplete' %}",
                dataType: "json",
                data: {
                    term: request.term
                },
                success: function(data) {
                    response(data);
                }
            });
        },
        minLength: 2,
    });
});
</script>



















    <section class="justify-content-evenly">
        <div class="container my-5 text-center">
        <div class="container-fluid text-center d-flex justify-content-center flex-wrap py-4 mt-5">
                <h1>Order from your favourite restaurant</h1>
        </div>

          

<!-- Restaurant Cards -->
<div class="row g-4" id="restaurant-list">
    {% for restaurant in restaurant_list %}
    <div class="col-md-4 restaurant-item" data-name="{{ restaurant.restaurantName|lower }}">
        <div class="restaurant-card">
            <img src="{% static 'images/background1.jpg'%}" alt="{{ restaurant.restaurantName }}" class="restaurant-image">
            <div class="restaurant-card-body">
                <h5 class="restaurant-card-title">{{ restaurant.restaurantName }}</h5>
            </div>
            <div class="restaurant-card-footer">
                <a href="{% url 'restaurant_menu' restaurant.id %}" class="btn w-100">View Menu</a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>


    <div class="container-fluid text-center d-flex justify-content-center flex-wrap py-5">
        <h1>Tasty food for you....!</h1>
    </div>
{% comment %} Food items  {% endcomment %}
   

    <div class="menu-container">
        <h1>Menu</h1>
        <div class="food-item-grid">
            {% for food in foodItems %}
                <div class="food-card" id="food-{{ food.id }}">
                    <img src="{{ food.image.url }}" alt="{{ food.name }}" class="food-img">
                    <h3>{{ food.name }}</h3>
                    <p class="price">â‚¹{{ food.price }}</p>
                    <p class="restaurant">{{ food.restaurantName.restaurantName }}</p>
                    <button class="add-to-cart-btn" id="btn-{{ food.id }}" onclick="toggleCart({{ food.id }})">
                        Add to Cart
                    </button>
                </div>
            {% endfor %}
        </div>
    </div>
    
    <script>
        function toggleCart(foodId) {
            var button = document.getElementById('btn-' + foodId);
            var foodCard = document.getElementById('food-' + foodId);
            var action = button.innerHTML.trim() === "Add to Cart" ? "add" : "remove";
            
            console.log("Button clicked for foodId:", foodId, "Action:", action);
    
            // Send the foodId to the server via a POST request
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "{% url 'menu' %}", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");  // Add CSRF token for security
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    // On success, toggle the button text and style
                    if (action === "add") {
                        button.innerHTML = "Remove from Cart";
                        button.style.backgroundColor = "#4CAF50";  // Green color for added items
                        button.style.cursor = "pointer";
                        foodCard.classList.add('added-to-cart');
                    } else {
                        button.innerHTML = "Add to Cart";
                        button.style.backgroundColor = "#FFA500";  // Original color for add to cart
                        button.style.cursor = "pointer";
                        foodCard.classList.remove('added-to-cart');
                    }
                    console.log("Button state updated for foodId:", foodId, "New state:", button.innerHTML.trim());
                }
            };
            xhr.send("id=" + foodId + "&action=" + action);
        }
    </script>


        <div class="container text-center justify-content-center mt-5">
        </div>
        {% include "home/footer.html" %}
        </body>

</body>
</html>